%--------------------------------------------------------------------------
% @file informe_final.tex
%
% @date 09/04/16 22:51:05
% @author Martin Noblia
% @email martin.noblia@openmailbox.org
%
% @brief
% Informe final de Sistemas digitales
% @detail
%
% Licence:
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or (at
% your option) any later version.
% 
% This program is distributed in the hope that it will be useful, but
% WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
% General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
%
%---------------------------------------------------------------------------
% Start
%---------------------------------------------------------------------------
\documentclass[10pt]{article}
%---------------------------------------------------------------------------
% Packages
%---------------------------------------------------------------------------
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{epigraph}
\usepackage{lipsum}
\usepackage{hyperref} 
\usepackage{listings}
\usepackage{fancyhdr}
\usepackage[utf8]{inputenc}
\usepackage{hyperref} 
\usepackage[spanish]{babel}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{graphicx}
\usepackage{color}
\usepackage{moredefs}
\usepackage{fancybox}
\usepackage{subfig}
\usepackage{float}
\usepackage{xcolor}
\usepackage{wallpaper}
\usepackage{textcomp}
\usepackage{minted}
%---------------------------------------------------------------------------
% Definitions
%---------------------------------------------------------------------------
\oddsidemargin -0.2in \textwidth 7.0in \topmargin -0.9in \textheight
9.0in
\parindent 3em
%---------------------------------------------------------------------------
% Cut of Spanish words
%---------------------------------------------------------------------------
\hyphenation{e-jem-plo
e-rro-res de-pen-dien-te co-rrien-te res-pues-ta fi-gu-ran
cons-tan-tes o-pe-ra-cion i-lu-mi-na-cion}
%---------------------------------------------------------------------------
% Page styles
%---------------------------------------------------------------------------
\pagestyle{fancy}
\headheight 50pt 
\renewcommand{\arrayrulewidth}{3pt} 
\newtheorem{defi}{{\it Definición}}[section]
%---------------------------------------------------------------------------
% Header page
%---------------------------------------------------------------------------
\rhead{\includegraphics[width=.075\textwidth]{./Images/logo_iaci2.eps}} % iaci logo
\chead{}
\lhead{Sistemas Digitales}
\rfoot{1º cuatrimestre 2016  }
\cfoot{\thepage}
\lfoot{\bf{Universidad Nacional de Quilmes}}
%---------------------------------------------------------------------------
% Colors
%---------------------------------------------------------------------------
\definecolor{azul-claro}{rgb}{0.335,0.89,1}
\definecolor{gainsboro}{rgb}{0.86,0.86,0.86}
\definecolor{mediumseagreen}{rgb}{0.24,0.7,0.44}
\definecolor{moccasin}{rgb}{1,0.89,0.71}
\definecolor{cornflowerblue}{rgb}{0.39,0.58,0.93}
\definecolor{lightgray}{rgb}{0.83,0.83,0.83}
\definecolor{darkgrey}{rgb}{0.66,0.66,0.66}
\definecolor{darkslategray}{rgb}{0.18,0.31,0.31}
\definecolor{lavender}{rgb}{0.9,0.9,0.98}
\definecolor{azure}{rgb}{0.94,1,1}
\definecolor{honeydew}{rgb}{0.94,1,0.94}
%---------------------------------------------------------------------------
% Custom section header(this shit generate a box color)
%---------------------------------------------------------------------------
\renewcommand{\arrayrulewidth}{1pt} 
\newcommand{\mcaja}[1]{%
{{\fboxsep 10pt \fboxrule 1pt%
\fcolorbox{black}{lightgray}{%
\color{black} \Huge #1}}}
}
\newcommand{\nuevobox}[1]{%
{{\fboxsep 14pt \fboxrule 1pt%
\fcolorbox{black}{darkgrey}{%
\color{lavender} \huge #1}}}
}
\newcommand{\ssection}[1]{\section[#1]{\mcaja{#1}}}
\makeatletter
\newcommand{\sect}[1]{\subsection[#1]{\nuevobox{#1}}}
\makeatletter
\def\section{\@ifstar\unnumberedsection\numberedsection}
\def\numberedsection{\@ifnextchar[%]
\numberedsectionwithtwoarguments\numberedsectionwithoneargument}
\def\unnumberedsection{\@ifnextchar[%]
\unnumberedsectionwithtwoarguments\unnumberedsectionwithoneargument}
\def\numberedsectionwithoneargument#1{\numberedsectionwithtwoarguments[#1]{#1}}
\def\unnumberedsectionwithoneargument#1{\unnumberedsectionwithtwoarguments[#1]{#1}}
\def\numberedsectionwithtwoarguments[#1]#2{%
\ifhmode\par\fi
\removelastskip
\vskip 3ex\goodbreak
\refstepcounter{section}%
\begingroup
%\noindent
\leavevmode\large\bfseries\raggedright\mcaja%%
\thesection\ #2\par\nobreak
\endgroup
\noindent\hrulefill\nobreak
\vskip 2ex\nobreak
\addcontentsline{toc}{section}{%
\protect\numberline{\thesection}%
#1}%
}
\def\unnumberedsectionwithtwoarguments[#1]#2{%
\ifhmode\par\fi
\removelastskip
\vskip 3ex\goodbreak
% \refstepcounter{section}%
\begingroup
\noindent
\leavevmode\Large\bfseries\raggedright
% \thesection\
#2\par\nobreak
\endgroup
\noindent\hrulefill\nobreak
\vskip 0ex\nobreak
\addcontentsline{toc}{section}{%
%
\protect\numberline{\thesection}%
#1}%
}
\makeatother
%%%Cap\’itulos
\usepackage{helvet}
%\usepackage{psboxit,pstcol}
\makeatletter
\def\@makechapterhead#1{%
{\parindent \z@ \raggedright \reset@font
\hbox to \hsize{%
\rlap{\raisebox{-2.5em}{\raisebox{\depth}{%%% Necesita la imagen "imgCapitulo"
\includegraphics[width=10em]{./Images/logo_iaci2.eps}}}}%
\rlap{\hbox to 6em{\hss
\reset@font\sffamily\fontsize{8em}{8em}\selectfont\black
\thechapter\hss}}%
\hspace{10em}%
\vbox{%
\advance\hsize by -10em
\reset@font\fontfamily{hv}\bfseries\Large
#1
\par
}%
}}%
\vskip 5pt
\hrulefill
\vskip 50pt
}
%---------------------------------------------------------------------------
% Redefinition of Theorems and Corollarys
%---------------------------------------------------------------------------
\makeatother
\newtheorem{theorem}{Teorema}[section]
\newtheorem{corollary}{Corolario}[theorem]
\newtheorem{lemma}[theorem]{Lema}
%---------------------------------------------------------------------------
% Title Page
%---------------------------------------------------------------------------
\definecolor{titlepagecolor}{cmyk}{1,.73,0,.37}


\newcommand\titlepagedecoration{%
\begin{tikzpicture}[remember picture,overlay,shorten >= -10pt]

\coordinate (aux1) at ([yshift=-15pt]current page.north east);
\coordinate (aux2) at ([yshift=-410pt]current page.north east);
\coordinate (aux3) at ([xshift=-4.5cm]current page.north east);
\coordinate (aux4) at ([yshift=-150pt]current page.north east);

\begin{scope}[titlepagecolor!40,line width=12pt,rounded corners=12pt]
\draw
  (aux1) -- coordinate (a)
  ++(225:5) --
  ++(-45:5.1) coordinate (b);
\draw[shorten <= -10pt]
  (aux3) --
  (a) --
  (aux1);
\draw[opacity=0.6,titlepagecolor,shorten <= -10pt]
  (b) --
  ++(225:2.2) --
  ++(-45:2.2);
\end{scope}
\draw[titlepagecolor,line width=8pt,rounded corners=8pt,shorten <= -10pt]
  (aux4) --
  ++(225:0.8) --
  ++(-45:0.8);
\begin{scope}[titlepagecolor!70,line width=6pt,rounded corners=8pt]
\draw[shorten <= -10pt]
  (aux2) --
  ++(225:3) coordinate[pos=0.45] (c) --
  ++(-45:3.1);
\draw
  (aux2) --
  (c) --
  ++(135:2.5) --
  ++(45:2.5) --
  ++(-45:2.5) coordinate[pos=0.3] (d);   
\draw 
  (d) -- +(45:1);
\end{scope}
\end{tikzpicture}%
}


\newcommand*{\plogo}{\fbox{$\mathcal{PL}$}}
\newcommand*{\titleGP}{\begingroup % Create the command for including the title page in the document
\centering % Center all text
\vspace*{\baselineskip} % White space at the top of the page

\rule{\textwidth}{1.6pt}\vspace*{-\baselineskip}\vspace*{2pt} % Thick horizontal line
\rule{\textwidth}{0.4pt}\\[\baselineskip] % Thin horizontal line

{\LARGE Sistemas Digitales\\[0.3\baselineskip] Trabajo Final}\\[0.2\baselineskip] % Title

\rule{\textwidth}{0.4pt}\vspace*{-\baselineskip}\vspace{3.2pt} % Thin horizontal line
\rule{\textwidth}{1.6pt}\\[\baselineskip] % Thick horizontal line

\scshape % Small caps
 Martín Noblía
\vspace*{2\baselineskip} % Whitespace between location/year and editors

Profesores: \\[\baselineskip]
{\Large Jose Juarez\\ Eric Pernia\par}
\vfill % Whitespace between editor names and publisher logo_iaci2
\includegraphics[width=.175\textwidth]{./Images/logo_iaci2.eps}

% Editor list
{\itshape Universidad Nacional de Quilmes \par} % Editor affiliation

\vfill % Whitespace between editor names and publisher logo

%\plogo \\[0.3\baselineskip] % Publisher logo
{\scshape 2016} \\[0.3\baselineskip] % Year published
%{\large THE PUBLISHER}\par % Publisher

\endgroup}


\begin{document}
\pagestyle{empty} 

\titleGP

\titlepagedecoration

\newpage
\pagestyle{fancy}

\section{Introduccion}

\begin{minted}{c}
void prvAnemometerTaks(void *pvParameters)
{
   /* Anemometer pin states */
   typedef enum{PIN_UP, PIN_FALLING, PIN_DOWN, PIN_RISING} pin_state_t;
   /* Auxiliar variables */
   portBASE_TYPE xFreq = 0;
   portBASE_TYPE xCounter = 0;
   portBASE_TYPE xTemp = 0;
   /* initial condition */
   pin_state_t pin_state = PIN_UP;
   /* message data */
   xMetaData xAnemometerMessage;
   /* message flag for the Gatekeeper */
   xAnemometerMessage.xSource = SENDER_ANEMOMETER;
   /* Task processig */
   while(1)
   {

      /* MEF for counting the states changes */
      switch(pin_state)
      {
         case PIN_UP:
            {
               if(!digitalRead(DIO32))
               {
                  pin_state = PIN_FALLING;
               }
               break;
            }
         case PIN_FALLING:
            {
               xCounter += 3;
               if(!digitalRead(DIO32))
               {
                  pin_state = PIN_DOWN;
                  xFreq++;
                  digitalWrite(LEDR, ON);
               }
               else
                  pin_state = PIN_UP;
               break;
            }
         case PIN_DOWN:
               {
               if(digitalRead(DIO32))
               {
                  pin_state = PIN_RISING;
               }
               break;
            }
         case PIN_RISING:
            {
               xCounter += 3;
               if(digitalRead(DIO32))
               {
                  pin_state = PIN_UP;
                  digitalWrite(LEDR, OFF);
               }
               else
               {
                  pin_state = PIN_DOWN;
               }
               break;
             }
         }

      if(xSemaphoreTake(xTimeSignal, ( TickType_t )0))
      {
         if(xFreq > FREQUENCY_ALARM_THRESHOLD_1)
         {
            xTemp = ALARM_MESSAGE_1;
            xQueueSendToBack(xALARMQueue, (void *)&xTemp, portMAX_DELAY);
         }
         if(xFreq > FREQUENCY_ALARM_THRESHOLD_2)
         {
            xTemp = ALARM_MESSAGE_2;
            xQueueSendToBack(xALARMQueue, (void *)&xTemp, portMAX_DELAY);
         }
         /* The time message arrive --> prepare the message package */
         xAnemometerMessage.xMessage = xFreq;
         /* send the package via the Gatekeeper */
         xQueueSendToBack(xUARTQueue, (void *)&xAnemometerMessage, ( TickType_t )0);
         /* reset the values */
         xFreq = 0;
         xCounter = 0;
      }
   }
   
\end{minted}

\newpage



%------------------------------------------------------------------------- 
% Bibliografia 
%-------------------------------------------------------------------------
\begin{thebibliography}{6} \bibitem{Principal}{Digital communications, fundamentals and applications. Bernard Sklar}\\ \bibitem{Principal2}{Julia: A fresh approach to numerical computing. Jeff Bezanson, Alan Edelman, Stefan Karpinski, Viral B. Shah(2014)}\url{http://arxiv.org/abs/1411.1607} 
\end{thebibliography} 

\end{document}
